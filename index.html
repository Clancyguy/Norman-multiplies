<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Norman's Aussie Math</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #87ceeb;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #87ceeb 60%, #e27d60 100%);
            overflow: hidden;
        }
        .leaf {
            position: absolute;
            background: #2d5a27;
            border-radius: 0 100% 0 100%;
            pointer-events: none;
            z-index: 1;
        }
        #player {
            position: absolute;
            bottom: 40px;
            width: 100px;
            height: 100px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            will-change: left;
            transition: transform 0.1s ease;
        }
        #player-value {
            position: absolute;
            color: #ffffff;
            font-size: 1.8rem;
            font-weight: 900;
            z-index: 11;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8);
            top: 30%;
        }
        .falling-problem {
            position: absolute;
            min-width: 85px;
            height: 55px;
            padding: 0 12px;
            background: #ffffff;
            border: 3px solid #8b4513;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 800;
            color: #3e2723;
            box-shadow: 0 5px 0px #5d4037;
            z-index: 5;
            white-space: nowrap;
        }
        #ui {
            position: absolute;
            top: env(safe-area-inset-top, 20px);
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            color: #3e2723;
            z-index: 20;
        }
        .ui-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 12px;
            border: 2px solid #8b4513;
            font-weight: bold;
            font-size: 0.9rem;
        }
        #overlay {
            position: absolute;
            inset: 0;
            background: rgba(46, 33, 27, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
            padding: 20px;
        }
        .btn {
            background: #ff9f1c;
            color: white;
            padding: 16px 40px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.3rem;
            border: none;
            cursor: pointer;
            margin: 8px;
            box-shadow: 0 6px 0px #cc7a00;
            width: 260px;
            max-width: 80vw;
            transition: all 0.1s;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0px #cc7a00; }
        .btn-secondary { background: #2ec4b6; box-shadow: 0 6px 0px #1e857c; }
        .btn-secondary:active { box-shadow: 0 2px 0px #1e857c; }

        .shrub {
            position: absolute;
            bottom: 0;
            background: #1b4332;
            border-radius: 50% 50% 0 0;
            z-index: 2;
        }
        
        .controls-hint {
            font-size: 0.75rem;
            margin-top: 10px;
            opacity: 0.7;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">
        <div class="ui-box">SCORE: <span id="score">0</span></div>
        <div class="ui-box">TREATS: <span id="lives">3</span></div>
    </div>

    <div class="shrub" style="left: -20px; width: 100px; height: 40px;"></div>
    <div class="shrub" style="right: -10px; width: 120px; height: 60px;"></div>

    <div id="player">
        <div id="player-value">?</div>
        <svg viewBox="0 0 100 100" class="w-full h-full">
            <path d="M25 35 L15 15 L35 25 Z" fill="#3e2723" />
            <path d="M75 35 L85 15 L65 25 Z" fill="#3e2723" />
            <circle cx="50" cy="50" r="40" fill="#fdfcf0" />
            <path d="M20 50 Q25 20 50 30 Q35 60 20 50" fill="#a0a0a0" />
            <path d="M80 50 Q75 20 50 30 Q65 60 80 50" fill="#5d4037" />
            <circle cx="38" cy="45" r="5" fill="#90e0ef" />
            <circle cx="62" cy="45" r="5" fill="#90e0ef" />
            <circle cx="38" cy="45" r="2.5" fill="black" />
            <circle cx="62" cy="45" r="2.5" fill="black" />
            <ellipse cx="50" cy="58" rx="7" ry="5" fill="black" />
            <path d="M42 65 Q50 72 58 65" fill="none" stroke="#000" stroke-width="2.5" />
        </svg>
    </div>

    <div id="overlay">
        <div id="overlay-content">
            <h1 class="text-4xl md:text-5xl font-black mb-2 leading-tight">NORMAN'S<br>MATH ADVENTURE</h1>
            <p class="text-sm md:text-lg opacity-80 mb-6 font-bold uppercase tracking-widest">Australian Shepherd Edition</p>
            
            <div class="bg-white/10 p-5 rounded-2xl mb-6 border border-white/20 text-sm max-w-xs mx-auto">
                <p class="mb-2">üê∂ Catch the equation that matches Norman's number!</p>
                <p>üö´ Avoid the wrong answers!</p>
                <div class="controls-hint hidden md:block">‚å®Ô∏è Use Arrow Keys or A/D to move</div>
            </div>

            <button class="btn" onclick="startGame()">START GAME</button>
            <br>
            <button class="btn btn-secondary" onclick="shareGame(event)">TEXT TO FRIENDS</button>
        </div>
    </div>
</div>

<script>
    const container = document.getElementById('game-container');
    const player = document.getElementById('player');
    const playerValueDisplay = document.getElementById('player-value');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const overlay = document.getElementById('overlay');
    const overlayContent = document.getElementById('overlay-content');

    let score = 0;
    let lives = 3;
    let gameActive = false;
    let playerX = window.innerWidth / 2 - 50;
    let currentPlayerTarget = 0;
    let fallSpeed = 4000;
    let spawnTimeoutId = null;
    let keyboardX = window.innerWidth / 2;

    function generateTarget() {
        const a = Math.floor(Math.random() * 8) + 2; 
        const b = Math.floor(Math.random() * 8) + 2; 
        currentPlayerTarget = a * b;
        playerValueDisplay.textContent = currentPlayerTarget;
    }

    function updatePlayerPos(x) {
        playerX = Math.max(0, Math.min(window.innerWidth - 100, x - 50));
        player.style.left = playerX + 'px';
        keyboardX = x;
    }

    window.addEventListener('keydown', (e) => {
        const step = 40;
        if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {
            updatePlayerPos(keyboardX - step);
        } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {
            updatePlayerPos(keyboardX + step);
        }
    });

    window.addEventListener('mousemove', (e) => updatePlayerPos(e.clientX));
    window.addEventListener('touchmove', (e) => {
        if(e.touches.length > 0) {
            updatePlayerPos(e.touches[0].clientX);
        }
    }, { passive: false });

    function createLeaf() {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        const size = Math.random() * 8 + 8;
        leaf.style.width = size + 'px';
        leaf.style.height = (size * 1.6) + 'px';
        leaf.style.left = Math.random() * 100 + 'vw';
        leaf.style.top = '-20px';
        container.appendChild(leaf);
        
        const anim = leaf.animate([
            { transform: `translateY(-20px) rotate(0deg)` },
            { transform: `translateY(110vh) rotate(${Math.random() * 720}deg) translateX(${Math.random() * 100 - 50}px)` }
        ], { duration: Math.random() * 3000 + 4000 });
        
        anim.onfinish = () => leaf.remove();
    }

    function createProblem() {
        if (!gameActive) return;

        const problem = document.createElement('div');
        problem.className = 'falling-problem';
        
        const isCorrect = Math.random() > 0.65;
        let val = 0;
        let text = "";

        if (isCorrect) {
            const factors = [];
            for(let i=1; i<=currentPlayerTarget; i++) {
                if(currentPlayerTarget % i === 0 && i < 13 && (currentPlayerTarget/i) < 13) {
                    factors.push(i);
                }
            }
            const fA = factors[Math.floor(Math.random() * factors.length)];
            const fB = currentPlayerTarget / fA;
            text = `${fA} √ó ${fB}`;
            val = currentPlayerTarget;
        } else {
            const a = Math.floor(Math.random() * 9) + 2;
            const b = Math.floor(Math.random() * 9) + 2;
            val = a * b;
            if (val === currentPlayerTarget) val += (Math.random() > 0.5 ? 2 : -2);
            text = `${a} √ó ${b}`;
        }

        problem.textContent = text;
        problem.style.left = Math.random() * (window.innerWidth - 100) + 'px';
        problem.style.top = '-70px';
        container.appendChild(problem);

        const anim = problem.animate([
            { top: '-70px' },
            { top: '100vh' }
        ], { duration: fallSpeed, easing: 'linear' });

        const collisionInterval = setInterval(() => {
            if (!gameActive) {
                clearInterval(collisionInterval);
                anim.cancel();
                problem.remove();
                return;
            }

            const r1 = problem.getBoundingClientRect();
            const r2 = player.getBoundingClientRect();

            if (r1.bottom > r2.top + 15 && r1.top < r2.bottom - 15 && 
                r1.right > r2.left + 10 && r1.left < r2.right - 10) {
                
                clearInterval(collisionInterval);
                anim.pause();
                problem.remove();

                if (val === currentPlayerTarget) {
                    score += 10;
                    scoreEl.textContent = score;
                    player.style.transform = 'scale(1.2)';
                    setTimeout(() => player.style.transform = 'scale(1)', 150);
                    generateTarget();
                    fallSpeed = Math.max(1500, fallSpeed - 60);
                } else {
                    lives--;
                    livesEl.textContent = lives;
                    player.style.filter = 'brightness(0.5) sepia(1)';
                    setTimeout(() => player.style.filter = '', 250);
                    if (lives <= 0) endGame();
                }
            }
        }, 30);

        anim.onfinish = () => {
            clearInterval(collisionInterval);
            problem.remove();
        };
    }

    function startGame() {
        document.querySelectorAll('.falling-problem').forEach(p => p.remove());
        if (spawnTimeoutId) clearTimeout(spawnTimeoutId);

        score = 0;
        lives = 3;
        fallSpeed = 4000;
        scoreEl.textContent = "0";
        livesEl.textContent = "3";
        gameActive = true;
        overlay.style.display = 'none';
        generateTarget();
        spawnLoop();
    }

    function spawnLoop() {
        if (!gameActive) return;
        createProblem();
        spawnTimeoutId = setTimeout(spawnLoop, Math.max(700, 1800 - (score * 2)));
    }

    function endGame() {
        gameActive = false;
        if (spawnTimeoutId) clearTimeout(spawnTimeoutId);
        
        overlay.style.display = 'flex';
        overlayContent.innerHTML = `
            <h1 class="text-4xl font-black mb-2">TUCKERED OUT!</h1>
            <p class="text-lg mb-6">Norman did a great job!</p>
            <div class="text-5xl font-bold mb-8 text-yellow-400">SCORE: ${score}</div>
            <button class="btn" onclick="startGame()">PLAY AGAIN</button>
            <br>
            <button class="btn btn-secondary" onclick="shareGame(event)">TEXT TO FRIENDS</button>
        `;
    }

    async function shareGame(e) {
        const url = window.location.href;
        const btn = e.target;
        const originalText = btn.innerText;

        if (navigator.share) {
            try {
                await navigator.share({
                    title: "Norman's Aussie Math",
                    text: `I just scored ${score} in Norman's Aussie Math! Can you beat me?`,
                    url: url
                });
                return;
            } catch (err) {}
        }

        try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(url);
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = url;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
            btn.innerText = "LINK COPIED!";
            btn.style.background = "#4ade80";
        } catch (err) {
            btn.innerText = "COULDN'T COPY";
        }

        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.background = "";
        }, 2000);
    }

    setInterval(createLeaf, 700);
    updatePlayerPos(window.innerWidth / 2);
    
    document.addEventListener('touchstart', (e) => {
        if (e.touches.length > 1) e.preventDefault();
    }, { passive: false });
</script>

</body>
</html>